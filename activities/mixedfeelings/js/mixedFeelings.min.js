function AudioChannel(e,t){this.scene=e,this.audioSprite=t,this.delayTimer=null,this.event=null,this.key=t.key,this.play=function(e,t,s){e.key==this.key?e.delay?this.delayedPlay(e.sprite,e.config,e.delay,t,s):this.playNow(e.sprite,e.config,t,s):console.log("Sound data must be from same AudioSprite. "+e.key+" != "+this.key)},this.stop=function(){this.audioSprite.stop(),this.clearDelayTimer(),this.cancelOnComplete()},this.getTime=function(){return this.audioSprite.seek},this.getMarker=function(){return this.audioSprite.currentMarker.name},this.playNow=function(e,t,s,i){this.stop(),this.audioSprite.play(e,t),this.clearDelayTimer(),s&&(this.event=this.audioSprite.once("complete",s,i))},this.delayedPlay=function(e,t,s,i,n){this.delayTimer=this.scene.time.delayedCall(s,this.playNow,[e,t,i,n],this)},this.clearDelayTimer=function(){null!=this.delayTimer&&(this.delayTimer.destroy(),this.delayTimer=null)},this.cancelOnComplete=function(){this.event&&this.event.removeAllListeners()}}function TextButton(t,e,s,i,n,a){this.config=t,this.context=e,this.upCallback=s,this.downCallback=i,this.overCallback=n,this.outCallback=a,this.data={},this.hitArea=null,this.hitAreaType=null,this.image=null,this.text=null,this.image=e.add.image(t.x,t.y,t.graphic.texture,t.graphic.up),t.text&&(this.text=e.add.text(t.x+t.text.xOffset,t.y+t.text.yOffset,t.text.label,t.text.upStyle),this.text.setOrigin(.5,.5)),t.flipX&&(this.image.flipX=!0),t.depth&&(this.image.depth=t.depth),t.hitArea&&"rect"==t.hitArea.type&&(this.hitAreaType=t.hitArea.type,this.hitArea=new Phaser.Geom.Rectangle(t.hitArea.x,t.hitArea.y,t.hitArea.width,t.hitArea.height)),this.enable=function(){null!=this.hitArea?"rect"==this.hitAreaType&&(this.image.removeInteractive(),this.image.setInteractive(this.hitArea,this.checkHitRect)):this.image.setInteractive(),this.image.on("pointerdown",this.onDown,this),this.image.on("pointerup",this.onUp,this),this.image.on("pointerover",this.onOver,this),this.image.on("pointerout",this.onOut,this),this.config.graphic.disabled&&this.image.setFrame(this.config.graphic.up)},this.disable=function(){this.image.disableInteractive(),this.image.removeListener("pointerdown",this.onDown,this),this.image.removeListener("pointerup",this.onUp,this),this.image.removeListener("pointerover",this.onOver,this),this.image.removeListener("pointerout",this.onOut,this),this.config.graphic.disabled&&this.image.setFrame(this.config.graphic.disabled)},this.setVisible=function(e){this.image.visible=e,this.text&&(this.text.visible=e)},this.setHighlight=function(e){this.config.graphic.highlight&&(1==e?this.image.setFrame(this.config.graphic.highlight):this.image.setFrame(this.config.graphic.up))},this.getImage=function(){return this.image},this.getVisuals=function(){var e=[this.image];return this.text&&e.push(this.text),e},this.setX=function(e){this.image.x=e,this.text&&(this.text.x=this.image.x+t.text.xOffset)},this.setY=function(e){this.image.y=e,this.text&&(this.text.y=this.image.y+t.text.yOffset)},this.setText=function(e){this.text&&(this.text.text=e)},this.onDown=function(){this.image.setFrame(this.config.graphic.down),this.text&&this.text.setStyle(this.config.text.downStyle),this.downCallback&&this.downCallback.call(this.context,this)},this.onOver=function(){this.image.setFrame(this.config.graphic.over),this.text&&this.text.setStyle(this.config.text.overStyle),this.overCallback&&this.overCallback.call(this.context,this)},this.onUp=function(){this.showUp(),this.upCallback&&this.upCallback.call(this.context,this)},this.onOut=function(){this.image.setFrame(this.config.graphic.up),this.text&&this.text.setStyle(this.config.text.upStyle),this.outCallback&&this.outCallback.call(this.context,this)},this.showSelected=function(){this.image.setFrame(this.config.graphic.selected),this.text&&this.text.setStyle(this.config.text.selectedStyle)},this.showUp=function(){this.image.setFrame(this.config.graphic.up),this.text&&this.text.setStyle(this.config.text.upStyle)},this.destroy=function(){this.disable(),this.image.destroy(),this.text&&this.text.destroy()},this.checkHitRect=function(e,t,s,i){return t>=e.x&&t<=e.x+e.width&&s>=e.y&&s<=e.y+e.height},this.setHitArea=function(e,t){"rect"==e&&(this.hitAreaType=e,this.hitArea=new Phaser.Geom.Rectangle(t.x,t.y,t.width,t.height))},this.enable()}!function(){function e(){var e=document.querySelector("canvas"),t=window.innerWidth,s=window.innerHeight,i=t/s,n=gSettings.gameConfig.width/gSettings.gameConfig.height;i<n?(e.style.width=t+"px",e.style.height=t/n+"px"):(e.style.width=s*n+"px",e.style.height=s+"px")}window.onload=function(){gSettings.autoScale&&(window.focus(),e(),window.addEventListener("resize",e)),gSettings.gameConfig.scene=[Boot,Clickthrough,Preload,GameBase,Splash,Menu,Puzzle,Instructions],gSettings.gameConfig.canvas=document.getElementById("game"),gSettings.gameConfig.type=Phaser.CANVAS,new Phaser.Game(gSettings.gameConfig)}}();var Boot=new Phaser.Scene("Boot");Boot.preload=function(){this.load.image(gSettings.loader.rotator.key,gSettings.loader.rotator.file);for(var e=0;e<gSettings.loader.backgroundElements.length;e++)this.load.image(gSettings.loader.backgroundElements[e].key,gSettings.loader.backgroundElements[e].file)},Boot.create=function(){var e=!0;if(gSettings.scormEnabled)e=SCORM_API_adapter.lmsInitialize();e?this.scene.start("Clickthrough"):alert("Unable to initialize SCORM API. Re-start course to try again.")};var Clickthrough=new Phaser.Scene("Clickthrough");Clickthrough.preload=function(){},Clickthrough.create=function(){this.addLoader(),this.input.on("pointerup",this.continue,this)},Clickthrough.addLoader=function(){for(var e=0;e<gSettings.loader.backgroundElements.length;e++)this.add.sprite(gSettings.loader.backgroundElements[e].x,gSettings.loader.backgroundElements[e].y,gSettings.loader.backgroundElements[e].key);this.add.sprite(gSettings.loader.rotator.x,gSettings.loader.rotator.y,gSettings.loader.rotator.key),this.add.text(gSettings.loader.clickthroughText.x,gSettings.loader.clickthroughText.y,gSettings.loader.clickthroughText.text,gSettings.loader.clickthroughText.style).setOrigin(gSettings.loader.clickthroughText.origin.x,gSettings.loader.clickthroughText.origin.y)},Clickthrough.continue=function(){this.scene.start("Preload")};var GameBase=new Phaser.Scene("GameBase");GameBase.init=function(e){this.voChannel=new AudioChannel(this,e.voSprite),this.sfxChannel=new AudioChannel(this,e.sfxSprite),this.progress=e.progress,this.splash=null,this.menu=null,this.puzzle=null,this.puzzleIndex=null},GameBase.preload=function(){},GameBase.create=function(){this.addSplash()},GameBase.update=function(){},GameBase.addSplash=function(){this.scene.launch("Splash"),this.splash=this.scene.get("Splash"),this.splash.events.on(this.splash.CONTINUE_CLICK,this.removeSplash,this)},GameBase.removeSplash=function(){this.scene.sleep("Splash"),this.addMenu()},GameBase.addMenu=function(){null==this.menu?(this.scene.launch("Menu"),this.menu=this.scene.get("Menu"),this.menu.events.on(this.menu.PUZZLE_CHOSEN,this.handlePuzzleChosen,this),gSettings.scormEnabled&&SCORM_API_adapter.markComplete()):this.scene.wake("Menu")},GameBase.handlePuzzleChosen=function(){this.puzzleIndex=this.menu.getPuzzleChoice(),this.scene.sleep("Menu"),this.addPuzzle()},GameBase.addPuzzle=function(){null==this.puzzle?(this.scene.launch("Puzzle"),this.puzzle=this.scene.get("Puzzle"),this.puzzle.events.on(this.puzzle.CREATION_COMPLETE,this.addPuzzle,this),this.puzzle.events.on(this.puzzle.CORRECT_ANSWER,this.handleCorrectAnswer,this),this.puzzle.events.on(this.puzzle.PUZZLE_COMPLETE,this.handlePuzzleComplete,this),this.puzzle.events.on(this.puzzle.MENU,this.handlePuzzleMenu,this)):(this.scene.wake("Puzzle"),this.puzzle.startPuzzle(this.puzzleIndex),gSettings.scormEnabled&&"not attempted"==SCORM_API_adapter.getObjectiveStatus(this.puzzleIndex)&&SCORM_API_adapter.setObjectiveStatus(this.puzzleIndex,"incomplete"))},GameBase.handleCorrectAnswer=function(){},GameBase.handlePuzzleComplete=function(){var e=this.puzzle.getJewelCount();e>this.progress[this.puzzleIndex]&&(this.progress[this.puzzleIndex]=e,gSettings.scormEnabled&&SCORM_API_adapter.setObjectiveScore(this.puzzleIndex,""+e)),gSettings.scormEnabled&&SCORM_API_adapter.setObjectiveStatus(this.puzzleIndex,"completed")},GameBase.handlePuzzleMenu=function(){this.scene.sleep("Puzzle"),this.addMenu()},GameBase.addBackgroundImages=function(e,t){for(var s=[],i=0;i<e.length;i++)s.push(this.addImage(e[i],t));return s},GameBase.addImage=function(e,t){var s=t.add.image(e.x,e.y,e.texture,e.frame);return e.flipX&&(s.flipX=!0),e.scaleX&&(s.scaleX=e.scaleX),e.scaleY&&(s.scaleY=e.scaleY),e.scale&&(s.scaleX=s.scaleY=e.scale),e.depth&&(s.depth=e.depth),s},GameBase.addText=function(e,t){var s=t.add.text(e.x,e.y,e.text,e.style);return s.setOrigin(e.origin.x,e.origin.y),s};var Instructions=new Phaser.Scene("Instructions");Instructions.CREATION_COMPLETE="creation-complete",Instructions.COMPLETE="complete",Instructions.init=function(){this.stepIndex=0},Instructions.preload=function(){},Instructions.create=function(){this.baseScene=this.scene.get("GameBase"),this.puzzle=this.scene.get("Puzzle"),this.events.on("wake",this.onWake,this),this.events.on("sleep",this.onSleep,this),this.events.emit(Instructions.CREATION_COMPLETE)},Instructions.update=function(){var e=this.baseScene.voChannel.getTime();1.877<e&&e<3.44&&1!=this.stepIndex?(this.stepIndex=1,this.highlight(this.puzzle.fragmentImages.concat(this.puzzle.fragmentTexts))):3.44<e&&e<9&&2!=this.stepIndex?(this.stepIndex=2,this.highlight(this.puzzle.dropTargets)):9<e&&e<12.57&&3!=this.stepIndex?(this.stepIndex=3,this.highlight(this.puzzle.jewels)):12.57<e&&e<29.57&&4!=this.stepIndex?(this.stepIndex=4,this.highlight(this.puzzle.hintButton.getImage())):29.57<e&&e<32.7&&5!=this.stepIndex?(this.stepIndex=5,this.highlight(this.puzzle.instructionsButton.getImage())):32.7<e&&6!=this.stepIndex&&(this.stepIndex=6)},Instructions.start=function(){this.stop(),this.baseScene.voChannel.play(gSettings.puzzle.instructionsVo,this.handleVoComplete,this)},Instructions.handleVoComplete=function(){this.events.emit(Instructions.COMPLETE)},Instructions.highlight=function(e){this.tweens.add({targets:e,scaleX:{value:1.25,duration:500,ease:"Circ.easeOut",yoyo:!0},scaleY:{value:1.25,duration:500,ease:"Circ.easeOut",yoyo:!0}})},Instructions.stop=function(){this.baseScene.voChannel.getMarker()==gSettings.puzzle.instructionsVo.sprite&&this.baseScene.voChannel.stop()},Instructions.onWake=function(){},Instructions.onSleep=function(){this.stop()};var LoadingAnimation=new Phaser.Scene("LoadingAnimation");LoadingAnimation.init=function(){this.rotator=null,this.rotatorTween=null},LoadingAnimation.preload=function(){},LoadingAnimation.create=function(){this.baseScene=this.scene.get("GameBase"),this.rotator=this.baseScene.addImage(gSettings.loadingAnimation.rotator,this),this.rotatorTween=this.tweens.add({targets:this.rotator,angle:360,duration:gSettings.loadingAnimation.rotator.rotationDuration,loop:-1,paused:!0}),this.add.text(gSettings.loadingAnimation.loadingText.x,gSettings.loadingAnimation.loadingText.y,gSettings.loadingAnimation.loadingText.text,gSettings.loadingAnimation.loadingText.style).setOrigin(gSettings.loadingAnimation.loadingText.origin.x,gSettings.loadingAnimation.loadingText.origin.y),this.startAnimation()},LoadingAnimation.startAnimation=function(){this.rotatorTween.resume()},LoadingAnimation.stopAnimation=function(){this.rotatorTween.pause()};var Menu=new Phaser.Scene("Menu");Menu.PUZZLE_CHOSEN="puzzle-chosen",Menu.init=function(){this.buttons=null,this.jewels=null,this.puzzleChoice=null},Menu.preload=function(){},Menu.create=function(){this.baseScene=this.scene.get("GameBase"),this.baseScene.addBackgroundImages(gSettings.menu.backgroundImages,this),this.baseScene.addText(gSettings.menu.headingText,this),this.events.on("wake",this.onWake,this),this.addButtons(),this.addJewelSlots(),this.showProgress(),this.playVo()},Menu.addButtons=function(){for(var e=0;e<gSettings.menu.puzzleButtons.length;e++){var t=gSettings.menu.puzzleButtons[e];t.graphic=gSettings.menu.puzzleButtonBase.graphic,t.text=gSettings.menu.puzzleButtonBase.text,t.text.label=gSettings.menu.puzzleButtons[e].label,new TextButton(t,this,this.onSelection).data.index=e}},Menu.onSelection=function(e){this.puzzleChoice=e.data.index,this.events.emit(this.PUZZLE_CHOSEN)},Menu.addJewelSlots=function(){for(var e=0;e<gSettings.menu.jewelSlotPositions.length;e++)for(var t=0;t<gSettings.menu.jewelSlots.length;t++){var s=this.baseScene.addImage(gSettings.menu.jewelSlots[t],this);s.x=gSettings.menu.jewelSlotPositions[e][t].x,s.y=gSettings.menu.jewelSlotPositions[e][t].y}},Menu.showProgress=function(){this.jewels=[];for(var e=0;e<this.baseScene.progress.length;e++)for(var t=0;t<this.baseScene.progress[e];t++){var s=this.baseScene.addImage(gSettings.menu.jewels[t],this);s.x=gSettings.menu.jewelSlotPositions[e][t].x,s.y=gSettings.menu.jewelSlotPositions[e][t].y,this.jewels.push(s)}},Menu.getPuzzleChoice=function(){return this.baseScene.voChannel.stop(),this.puzzleChoice},Menu.playVo=function(){this.baseScene.voChannel.play(gSettings.menu.audio)},Menu.onWake=function(){for(var e=0;e<this.jewels.length;e++)this.jewels[e].destroy();this.showProgress(),this.playVo()};var Preload=new Phaser.Scene("Preload");Preload.init=function(){this.progress=null},Preload.preload=function(){this.addLoader();for(var e=0;e<gSettings.spritesheets.length;e++)this.load.atlas(gSettings.spritesheets[e]);this.load.audioSprite(gSettings.voSprite),this.load.audioSprite(gSettings.sfxSprite),this.initializeObjectives()},Preload.create=function(){this.rotatorTween.stop();var e=this.sound.addAudioSprite(gSettings.voSprite.key),t=this.sound.addAudioSprite(gSettings.sfxSprite.key);this.scene.start("GameBase",{voSprite:e,sfxSprite:t,progress:this.progress})},Preload.initializeObjectives=function(){if(this.progress=[],gSettings.scormEnabled){var e=SCORM_API_adapter.getObjectiveCount();if(0==e)for(var t=0;t<gSettings.puzzle.questions.length;t++)SCORM_API_adapter.createObjective(t,"Puzzle_"+(t+1),"not attempted"),SCORM_API_adapter.setObjectiveScore(t,"0"),this.progress.push(0);else for(t=0;t<e;t++)this.progress.push(Number(SCORM_API_adapter.getObjectiveScore(t)))}else for(t=0;t<gSettings.puzzle.questions.length;t++)this.progress.push(0)},Preload.addLoader=function(){for(var e=0;e<gSettings.loader.backgroundElements.length;e++)this.add.sprite(gSettings.loader.backgroundElements[e].x,gSettings.loader.backgroundElements[e].y,gSettings.loader.backgroundElements[e].key);var t=this.add.sprite(gSettings.loader.rotator.x,gSettings.loader.rotator.y,gSettings.loader.rotator.key);this.rotatorTween=this.tweens.add({targets:t,angle:360,duration:gSettings.loader.rotator.rotationDuration,loop:-1}),this.add.text(gSettings.loader.loadingText.x,gSettings.loader.loadingText.y,gSettings.loader.loadingText.text,gSettings.loader.loadingText.style).setOrigin(gSettings.loader.loadingText.origin.x,gSettings.loader.loadingText.origin.y)};var Puzzle=new Phaser.Scene("Puzzle");Puzzle.CREATION_COMPLETE="creation-complete",Puzzle.CORRECT_ANSWER="correct-answer",Puzzle.PUZZLE_COMPLETE="puzzle-complete",Puzzle.MENU="menu",Puzzle.init=function(e){this.puzzleIndex=null,this.questionIndex=null,this.hintButton=null,this.instructionsButton=null,this.counterText=null,this.question=null,this.jewels=null,this.fragmentImages=null,this.fragmentTexts=null,this.dropTargets=null,this.jewelSlots=null,this.instructions=null,this.sparkleTimer=null},Puzzle.preload=function(){},Puzzle.create=function(){this.baseScene=this.scene.get("GameBase"),this.baseScene.addBackgroundImages(gSettings.puzzle.backgroundImages,this),new TextButton(gSettings.puzzle.menuButton,this,this.handleMenu),this.addAttractor(),this.events.on("wake",this.onWake,this),this.events.on("sleep",this.onSleep,this),this.events.emit(this.CREATION_COMPLETE)},Puzzle.update=function(){if(null!=this.fragmentTexts)for(var e=0;e<this.fragmentTexts.length;e++)this.fragmentTexts[e].x=this.fragmentImages[e].x,this.fragmentTexts[e].y=this.fragmentImages[e].y},Puzzle.addAttractor=function(){this.matter.add.circle(gSettings.puzzle.attractor.x,gSettings.puzzle.attractor.y,gSettings.puzzle.attractor.radius,{isStatic:!0,plugin:{attractors:[function(e,t){return{x:15e-7*(e.position.x-t.position.x),y:15e-7*(e.position.y-t.position.y)}}]}})},Puzzle.startPuzzle=function(e){this.puzzleIndex=e,this.questionIndex=0,this.clearJewelSlots(),this.addHintButton(),this.addInstructionsButton(),this.setCounterText(),this.setQuestion(),this.addDropTargets(),this.addJewels(),this.setFragments(),this.setDragEvents()},Puzzle.handleMenu=function(){this.baseScene.voChannel.stop(),this.killInstructions(),this.events.emit(Puzzle.MENU)},Puzzle.addHintButton=function(){null==this.hintButton?this.hintButton=new TextButton(gSettings.puzzle.hintButton,this,this.handleHint):(this.hintButton.setVisible(!0),this.hintButton.enable())},Puzzle.handleHint=function(){this.killInstructions();for(var e=gSettings.puzzle.questions[this.puzzleIndex][this.questionIndex].fragments,t=0;t<this.fragmentTexts.length;t++)-1!=e.indexOf(this.fragmentTexts[t].text)&&this.fragmentImages[t].setFrame(gSettings.puzzle.fragmentImages[this.fragmentImages[t].getData("imageIndex")].highlightFrame);this.baseScene.sfxChannel.play(gSettings.puzzle.hintSfx,this.removeJewel,this)},Puzzle.addInstructionsButton=function(){null==this.instructionsButtons?this.instructionsButton=new TextButton(gSettings.puzzle.instructionsButton,this,this.addInstructions):this.instructionsButtons.setVisible(!0)},Puzzle.addInstructions=function(){null==this.instructions?(this.scene.launch("Instructions"),this.instructions=this.scene.get("Instructions"),this.instructions.events.on(this.instructions.CREATION_COMPLETE,this.addInstructions,this),this.instructions.events.on(this.instructions.COMPLETE,this.killInstructions,this)):(this.baseScene.voChannel.stop(),this.scene.wake("Instructions"),this.instructions.start())},Puzzle.killInstructions=function(){null!=this.instructions&&this.scene.sleep("Instructions")},Puzzle.setCounterText=function(){null==this.counterText&&(this.counterText=this.baseScene.addText(gSettings.puzzle.counterText,this)),this.counterText.text="QUESTION "+(this.questionIndex+1)+" of "+gSettings.puzzle.questions[this.puzzleIndex].length},Puzzle.setQuestion=function(){null==this.question&&(this.question=this.baseScene.addText(gSettings.puzzle.questionText,this)),this.question.text=gSettings.puzzle.questions[this.puzzleIndex][this.questionIndex].question,this.baseScene.voChannel.play(gSettings.puzzle.questions[this.puzzleIndex][this.questionIndex].audio)},Puzzle.addDropTargets=function(){this.resetDropTargets();for(var e=400-gSettings.puzzle.dropTargetInterval*(gSettings.puzzle.questions[this.puzzleIndex][this.questionIndex].fragments.length-1)/2,t=0;t<gSettings.puzzle.questions[this.puzzleIndex][this.questionIndex].fragments.length;t++){var s=this.baseScene.addImage(gSettings.puzzle.dropTarget,this);s.x=e+gSettings.puzzle.dropTargetInterval*t,s.setData("value",""),this.dropTargets.push(s)}},Puzzle.resetDropTargets=function(){if(null==this.dropTargets)this.dropTargets=[];else{for(var e=0;e<this.dropTargets.length;e++)this.dropTargets[e].destroy();this.dropTargets=[]}},Puzzle.addJewels=function(){if(null==this.jewels)this.jewels=[];else{for(var e=0;e<this.jewels.length;e++)this.jewels[e].destroy();this.jewels=[]}for(e=0;e<gSettings.puzzle.jewels.length;e++){var t=this.matter.add.sprite(gSettings.puzzle.jewels[e].x,gSettings.puzzle.jewels[e].y,gSettings.puzzle.jewels[e].texture,gSettings.puzzle.jewels[e].frame,gSettings.puzzle.jewelBodyOptions);t.setBody(gSettings.puzzle.jewels[e].body),t.setRandomPosition(gSettings.puzzle.randomStartPositionBounds.x,gSettings.puzzle.randomStartPositionBounds.y,gSettings.puzzle.randomStartPositionBounds.width,gSettings.puzzle.randomStartPositionBounds.height),this.jewels.push(t)}this.startSparkle()},Puzzle.setFragments=function(){this.resetFragmentImages(),this.resetFragmentTexts();for(var e=0;e<gSettings.puzzle.questions[this.puzzleIndex].length;e++)for(var t=0;t<gSettings.puzzle.questions[this.puzzleIndex][e].fragments.length;t++)this.fragmentImages.push(this.createFragmentImage()),this.fragmentTexts.push(this.createFragmentText(e,t));this.baseScene.sfxChannel.play(gSettings.puzzle.puzzleStartSfx)},Puzzle.resetFragmentImages=function(){if(null==this.fragmentImages)this.fragmentImages=[];else{for(var e=0;e<this.fragmentImages.length;e++)this.fragmentImages[e].destroy();this.fragmentImages=[]}},Puzzle.resetFragmentTexts=function(){if(null==this.fragmentTexts)this.fragmentTexts=[];else{for(var e=0;e<this.fragmentTexts.length;e++)this.fragmentTexts[e].destroy();this.fragmentTexts=[]}},Puzzle.createFragmentImage=function(){var e=Math.floor(Math.random()*gSettings.puzzle.fragmentImages.length),t=this.matter.add.image(gSettings.puzzle.fragmentImages[e].x,gSettings.puzzle.fragmentImages[e].y,gSettings.puzzle.fragmentImages[e].texture,gSettings.puzzle.fragmentImages[e].frame,gSettings.puzzle.fragmentBodyOptions);return t.setData("imageIndex",e),t.setBody(gSettings.puzzle.fragmentImages[e].body),t.setRandomPosition(gSettings.puzzle.randomStartPositionBounds.x,gSettings.puzzle.randomStartPositionBounds.y,gSettings.puzzle.randomStartPositionBounds.width,gSettings.puzzle.randomStartPositionBounds.height),t.setInteractive(new Phaser.Geom.Circle(48,48,35),this.fragmentHitAreaCheck),this.input.setDraggable(t),t.setData("onTarget",-1),t},Puzzle.fragmentHitAreaCheck=function(e,t,s,i){return!!e.contains(t,s)},Puzzle.createFragmentText=function(e,t){var s=this.baseScene.addText(gSettings.puzzle.fragmentText,this);return s.text=gSettings.puzzle.questions[this.puzzleIndex][e].fragments[t],s},Puzzle.getFragmentCount=function(){for(var e=0;0<gSettings.puzzle.questions[this.puzzleIndex].length;j++)e+=gSettings.puzzle.questions[this.puzzleIndex][0].fragments.length;return e},Puzzle.checkCorrect=function(){for(var e=0,t=0;t<this.dropTargets.length;t++)""==this.dropTargets[t].getData("value")?this.setDropTargetMode(t,"default"):e++;var s=!0;if(e==this.dropTargets.length){for(t=0;t<this.dropTargets.length;t++)gSettings.puzzle.questions[this.puzzleIndex][this.questionIndex].fragments[t]==this.dropTargets[t].getData("value")?this.setDropTargetMode(t,"correct"):(this.setDropTargetMode(t,"incorrect"),s=!1);s?this.baseScene.sfxChannel.play(gSettings.puzzle.correctAnswerSfx,this.handleCorrectAttempt,this):this.baseScene.sfxChannel.play(gSettings.puzzle.dropOnTargetSfx,this.handleIncorrectAttempt,this)}else 0<e&&this.baseScene.sfxChannel.play(gSettings.puzzle.dropOnTargetSfx)},Puzzle.handleCorrectAttempt=function(){this.removeDragEvents();var e=Math.floor(Math.random()*gSettings.puzzle.correctAudio.length);this.baseScene.voChannel.play(gSettings.puzzle.correctAudio[e],this.handleCorrectVoComplete,this),this.events.emit(this.CORRECT_ANSWER)},Puzzle.handleCorrectVoComplete=function(){this.time.delayedCall(1e3,this.nextQuestion,[],this)},Puzzle.nextQuestion=function(){this.questionIndex+1<gSettings.puzzle.questions[this.puzzleIndex].length?(this.clearCorrectFragments(),this.questionIndex++,this.setCounterText(),this.setQuestion(),this.addDropTargets(),this.setDragEvents()):(this.removeDragEvents(),this.events.emit(this.PUZZLE_COMPLETE),this.showCompletion())},Puzzle.clearCorrectFragments=function(){for(var e=[],t=0;t<this.fragmentImages.length;t++)-1!=this.fragmentImages[t].getData("onTarget")&&e.push(t);for(t=e.length-1;0<=t;t--){this.fragmentImages.splice(e[t],1)[0].destroy(),this.fragmentTexts.splice(e[t],1)[0].destroy()}},Puzzle.handleIncorrectAttempt=function(){this.removeJewel(),this.releaseIncorrectFragments()},Puzzle.removeJewel=function(){0<this.jewels.length&&(this.jewels.pop().destroy(),0==this.jewels.length&&this.hintButton.disable(),this.baseScene.sfxChannel.play(gSettings.puzzle.jewelDisappearSfx))},Puzzle.releaseIncorrectFragments=function(){for(var e=0;e<this.fragmentImages.length;e++){var t=this.fragmentImages[e].getData("onTarget");-1!=t&&gSettings.puzzle.questions[this.puzzleIndex][this.questionIndex].fragments[t]!=this.dropTargets[t].getData("value")&&(this.fragmentImages[e].setStatic(!1),this.dropTargets[t].setData("value",""),this.fragmentImages[e].setData("onTarget",-1),this.time.delayedCall(1e3,this.setDropTargetMode,[t,"default"],this))}},Puzzle.setDropTargetMode=function(e,t){var s=null;switch(t){case"correct":s=gSettings.puzzle.dropTarget.correctFrame;break;case"incorrect":s=gSettings.puzzle.dropTarget.incorrectFrame;break;case"default":s=gSettings.puzzle.dropTarget.frame}this.dropTargets[e].setFrame(s)},Puzzle.getJewelCount=function(){return this.jewels.length},Puzzle.showCompletion=function(){this.hintButton.setVisible(!1),this.instructionsButton.setVisible(!1),this.counterText.text="",this.question.text="",this.clearCorrectFragments(),this.resetDropTargets(),this.addJewelSlots(),this.moveJewelsToSlots()},Puzzle.addJewelSlots=function(){if(null==this.jewelSlots){this.jewelSlots=[];for(var e=0;e<gSettings.puzzle.completionJewelSlots.length;e++){var t=this.baseScene.addImage(gSettings.puzzle.completionJewelSlots[e],this);this.jewelSlots.push(t)}}else for(e=0;e<this.jewelSlots.length;e++)this.jewelSlots[e].visible=!0},Puzzle.moveJewelsToSlots=function(){for(var e=0;e<this.jewels.length;e++)this.jewels[e].setStatic(!0),this.time.delayedCall(500*(e+1),function(e){this.jewels[e].setDepth(101),this.jewels[e].x=this.jewelSlots[e].x,this.jewels[e].y=this.jewelSlots[e].y,this.jewels[e].angle=0,this.baseScene.sfxChannel.play(gSettings.puzzle.jewelToSlotSfx)},[e],this);this.time.delayedCall(500*(this.jewels.length+1),this.showCompletionText,[],this)},Puzzle.showCompletionText=function(){for(var e=this.getJewelCount(),t=0;t<gSettings.puzzle.completionText.length;t++)if(e>=gSettings.puzzle.completionText[t].min&&e<=gSettings.puzzle.completionText[t].max){this.question.text=gSettings.puzzle.completionText[t].text,this.baseScene.voChannel.play(gSettings.puzzle.completionText[t].audio);break}},Puzzle.clearJewelSlots=function(){if(null!=this.jewelSlots)for(var e=0;e<this.jewelSlots.length;e++)this.jewelSlots[e].visible=!1},Puzzle.startSparkle=function(){this.sparkleTimer=this.time.addEvent({delay:2e3,loop:!0,callback:this.showSparkle,callbackScope:this})},Puzzle.showSparkle=function(){if(0==Math.floor(2*Math.random())&&0<this.jewels.length){var e=Math.floor(Math.random()*this.jewels.length),t=gSettings.puzzle.jewels[e].sparkleAnimation.key;this.anims.exists(t)||this.anims.create({key:gSettings.puzzle.jewels[e].sparkleAnimation.key,frames:this.anims.generateFrameNames(gSettings.puzzle.jewels[e].texture),loop:!0}),this.jewels[e].play(t)}},Puzzle.stopSparkle=function(){null!=this.sparkleTimer&&(this.sparkleTimer.destroy(),this.sparkleTimer=null)},Puzzle.onSleep=function(){this.stopSparkle()},Puzzle.onWake=function(){},Puzzle.setDragEvents=function(){0==this.input.listenerCount("drag")&&this.input.on("drag",this.onDrag,this),0==this.input.listenerCount("dragstart")&&this.input.on("dragstart",this.onDragstart,this),0==this.input.listenerCount("dragend")&&this.input.on("dragend",this.onDragend,this)},Puzzle.removeDragEvents=function(){this.input.off("drag",this.onDrag,this),this.input.off("dragstart",this.onDragstart,this),this.input.off("dragend",this.onDragend,this)},Puzzle.onDrag=function(e,t,s,i){t.x=s,t.y=i},Puzzle.onDragstart=function(e,t){t.isStatic()||t.setStatic(!0);var s=this.fragmentImages.indexOf(t);t.setDepth(100),this.fragmentTexts[s].setDepth(101)},Puzzle.onDragend=function(e,t){this.killInstructions();for(var s=this.fragmentImages.indexOf(t),i=null,n=new Phaser.Geom.Circle(t.x,t.y,gSettings.puzzle.fragmentImages[0].body.radius),a=0;a<this.dropTargets.length;a++){var o=new Phaser.Geom.Circle(this.dropTargets[a].x,this.dropTargets[a].y,gSettings.puzzle.dropTarget.hitRadius);if(Phaser.Geom.Intersects.CircleToCircle(n,o)&&(""==this.dropTargets[a].getData("value")||this.dropTargets[a].getData("value")==this.fragmentTexts[s].text)){i=a;break}}var r=t.getData("onTarget");null==i?(-1!=r&&(this.dropTargets[r].setData("value",""),t.setData("onTarget",-1)),t.setStatic(!1)):(-1!=r&&this.dropTargets[r].setData("value",""),this.dropTargets[i].setData("value",this.fragmentTexts[s].text),t.setData("onTarget",i),t.x=this.dropTargets[i].x,t.y=this.dropTargets[i].y),this.checkCorrect()},Puzzle.dumpData=function(){console.log("*************");for(var e="",t=0;t<this.dropTargets.length;t++)e+=this.dropTargets[t].getData("value"),t<this.dropTargets.length-1&&(e+="-");console.log(e),console.log("-------------");for(t=0;t<this.fragmentImages.length;t++)console.log(this.fragmentTexts[t].text+" "+this.fragmentImages[t].getData("onTarget"));console.log("*************")};var Splash=new Phaser.Scene("Splash");Splash.CONTINUE_CLICK="continue-click",Splash.init=function(){},Splash.preload=function(){},Splash.create=function(){this.baseScene=this.scene.get("GameBase"),this.baseScene.addBackgroundImages(gSettings.splash.backgroundImages,this);var e=this.add.graphics();e.fillStyle(gSettings.splash.textScreen.color,gSettings.splash.textScreen.alpha),e.fillRoundedRect(gSettings.splash.textScreen.x,gSettings.splash.textScreen.y,gSettings.splash.textScreen.width,gSettings.splash.textScreen.height,gSettings.splash.textScreen.radius),this.baseScene.addText(gSettings.splash.introText,this),new TextButton(gSettings.splash.continueButton,this,this.onContinue),this.baseScene.voChannel.play(gSettings.splash.audio)},Splash.onContinue=function(){this.baseScene.voChannel.stop(),this.events.emit(this.CONTINUE_CLICK)},gSettings={scormEnabled:!1,autoScale:!0,gameConfig:{width:800,height:600,backgroundColor:462102,physics:{default:"matter",matter:{debug:!1,gravity:{scale:0},plugins:{attractors:!0}}}},spritesheets:[{key:"general",textureURL:"images/general.png",atlasURL:"images/general.json"},{key:"jewel1",textureURL:"images/jewel1.png",atlasURL:"images/jewel1.json"},{key:"jewel2",textureURL:"images/jewel2.png",atlasURL:"images/jewel2.json"},{key:"jewel3",textureURL:"images/jewel3.png",atlasURL:"images/jewel3.json"},{key:"jewel4",textureURL:"images/jewel4.png",atlasURL:"images/jewel4.json"}],voSprite:{key:"vo",jsonURL:"audio/mixedfeelings-vo.json",audioURL:["audio/mixedfeelings-vo.m4a","audio/mixedfeelings-vo.ogg"]},sfxSprite:{key:"sfx",jsonURL:"audio/mixedfeelings-sfx.json",audioURL:["audio/mixedfeelings-sfx.m4a","audio/mixedfeelings-sfx.ogg"]},loader:{rotator:{key:"rotator",file:"images/rotator.png",x:358,y:268,rotationDuration:2e3},backgroundElements:[{x:400,y:261,key:"logo",file:"images/logo.png"}],loadingText:{text:"Loading...",x:400,y:451,origin:{x:.5,y:.5},style:{fontFamily:"Arial, Helvetica, sans",fontSize:36,fontStyle:"700",color:"#ffffff"}},clickthroughText:{text:"Tap or click here to continue.",x:400,y:451,origin:{x:.5,y:.5},style:{fontFamily:"Arial, Helvetica, sans",fontSize:36,fontStyle:"700",color:"#ffffff"}}},splash:{backgroundImages:[{x:400,y:300,texture:"general",frame:"background.png"},{x:400,y:125,texture:"general",frame:"logo.png"}],textScreen:{color:0,alpha:.5,x:150,y:235,width:500,height:100,radius:15},introText:{text:"Welcome to Mixed Feelings!\nEarn jewels by sorting out the answers to questions about feelings.",x:400,y:247,origin:{x:.5,y:0},style:{fontFamily:"Russo One, Arial, Helvetica, sans",fontSize:22,color:"#ffffff",align:"center",wordWrap:{width:470}}},continueButton:{x:400,y:421,graphic:{texture:"general",up:"playUp.png",over:"playOver.png",down:"playOver.png"}},audio:{key:"vo",sprite:"Splash",delay:500,config:{}}},menu:{backgroundImages:[{x:400,y:300,texture:"general",frame:"background.png"},{x:226,y:333,texture:"general",frame:"glare.png"},{x:400,y:333,texture:"general",frame:"glare.png"},{x:573,y:333,texture:"general",frame:"glare.png"}],headingText:{text:"CHOOSE A PUZZLE",x:400,y:145,origin:{x:.5,y:0},style:{fontFamily:"Russo One, Arial, Helvetica, sans",fontSize:50,color:"#ffffff",align:"center"}},puzzleButtonBase:{graphic:{texture:"general",up:"puzzleUp.png",over:"puzzleOver.png",down:"puzzleOver.png"},text:{label:"-",upStyle:{fontFamily:"Russo One, Arial, Helvetica, sans",fontSize:70,color:"#000000",align:"center"},overStyle:{fontFamily:"Russo One, Arial, Helvetica, sans",fontSize:70,color:"#000000",align:"center"},downStyle:{fontFamily:"Russo One, Arial, Helvetica, sans",fontSize:70,color:"#000000",align:"center"},xOffset:0,yOffset:0}},puzzleButtons:[{x:140,y:300,label:"1"},{x:313,y:300,label:"2"},{x:487,y:300,label:"3"},{x:660,y:300,label:"4"}],jewelSlots:[{x:0,y:0,texture:"general",frame:"jewel1Slot.png"},{x:0,y:0,texture:"general",frame:"jewel2Slot.png"},{x:0,y:0,texture:"general",frame:"jewel3Slot.png"},{x:0,y:0,texture:"general",frame:"jewel4Slot.png"}],jewelSlotPositions:[[{x:96,y:380},{x:124,y:380},{x:152,y:380},{x:184,y:380}],[{x:269,y:380},{x:297,y:380},{x:325,y:380},{x:357,y:380}],[{x:443,y:380},{x:471,y:380},{x:499,y:380},{x:531,y:380}],[{x:616,y:380},{x:644,y:380},{x:672,y:380},{x:704,y:380}]],jewels:[{x:0,y:0,texture:"jewel1",frame:"jewel10001.png",scale:.48},{x:0,y:0,texture:"jewel2",frame:"jewel20001.png",scale:.48},{x:0,y:0,texture:"jewel3",frame:"jewel30001.png",scale:.48},{x:0,y:0,texture:"jewel4",frame:"jewel40001.png",scale:.48}],audio:{key:"vo",sprite:"Menu",delay:500,config:{}}},puzzle:{backgroundImages:[{x:400,y:300,texture:"general",frame:"background.png"},{x:39,y:101,texture:"general",frame:"glare.png"},{x:761,y:101,texture:"general",frame:"glare.png"}],menuButton:{x:61,y:36,graphic:{texture:"general",up:"menuUp.png",over:"menuOver.png",down:"menuOver.png"}},hintButton:{x:565,y:36,graphic:{texture:"general",up:"hintUp.png",over:"hintOver.png",down:"hintOver.png",disabled:"hintDisabled.png"}},instructionsButton:{x:707,y:36,graphic:{texture:"general",up:"instructionsUp.png",over:"instructionsOver.png",down:"instructionsOver.png"}},counterText:{text:"",x:400,y:60,origin:{x:.5,y:0},style:{fontFamily:"Lato, Arial, Helvetica, sans",fontSize:14,fontStyle:"700",color:"#007cc2",align:"center"}},questionText:{text:"",x:400,y:90,origin:{x:.5,y:0},style:{fontFamily:"Russo One, Arial, Helvetica, sans",fontSize:22,color:"#ffffff",align:"center",wordWrap:{width:660}}},questions:[[{question:"If someone has a big smile on their face, and is talking excitedly, how do you think they are feeling?",audio:{key:"vo",sprite:"Puzzle 1 Question 1",delay:1e3,config:{}},fragments:["HAP","PY"]},{question:"When you are angry what should you try to do?",audio:{key:"vo",sprite:"Puzzle 1 Question 2",delay:500,config:{}},fragments:["CALM","DOWN"]},{question:"What is it called when you try to understand how someone is feeling?",audio:{key:"vo",sprite:"Puzzle 1 Question 3",delay:500,config:{}},fragments:["EMP","ATHY"]},{question:"What is one way to calm down when you are angry?",audio:{key:"vo",sprite:"Puzzle 1 Question 4",delay:500,config:{}},fragments:["COUNT","TO","TEN"]}],[{question:"What is another name for feelings?",audio:{key:"vo",sprite:"Puzzle 2 Question 1",delay:1e3,config:{}},fragments:["EMO","TIONS"]},{question:"When you are angry, what is one thing you can do to take a break from the situation?",audio:{key:"vo",sprite:"Puzzle 2 Question 2",delay:500,config:{}},fragments:["WALK","AWAY"]},{question:"If you are worried about giving a book report in class, what could you do to make yourself worry less?",audio:{key:"vo",sprite:"Puzzle 2 Question 3",delay:500,config:{}},fragments:["PRAC","TICE"]},{question:"When you need help dealing with your emotions, who should you talk to?",audio:{key:"vo",sprite:"Puzzle 2 Question 4",delay:500,config:{}},fragments:["TRU","STED","ADULT"]}],[{question:"If someone is scowling and has their arms crossed, how do you think they are feeling?",audio:{key:"vo",sprite:"Puzzle 3 Question 1",delay:1e3,config:{}},fragments:["AN","GRY"]},{question:"What is someone called who is trained to help kids deal with all kinds of emotions, including anxiety and worry?",audio:{key:"vo",sprite:"Puzzle 3 Question 3",delay:500,config:{}},fragments:["COUN","SELOR"]},{question:"What is an example of a trusted adult?",audio:{key:"vo",sprite:"Puzzle 3 Question 2",delay:500,config:{}},fragments:["TEA","CHER"]},{question:"What is one thing that can tell us how a person is feeling?",audio:{key:"vo",sprite:"Puzzle 3 Question 4",delay:500,config:{}},fragments:["BODY","LAN","GUAGE"]}],[{question:"What is it called when you are worried all the time and it affects your daily life?",audio:{key:"vo",sprite:"Puzzle 4 Question 3",delay:1e3,config:{}},fragments:["ANX","IETY"]},{question:"What should we always try to show others?",audio:{key:"vo",sprite:"Puzzle 4 Question 2",delay:500,config:{}},fragments:["KIND","NESS"]},{question:"What is a feeling that everyone experiences sometimes? You might feel it before giving a presentation at school.",audio:{key:"vo",sprite:"Puzzle 4 Question 1",delay:500,config:{}},fragments:["WOR","RY"]},{question:"What is it called when you help and support others?",audio:{key:"vo",sprite:"Puzzle 4 Question 4",delay:500,config:{}},fragments:["COM","PASS","ION"]}]],correctAudio:[{key:"vo",sprite:"Correct",delay:0,config:{}},{key:"vo",sprite:"That's correct",delay:0,config:{}},{key:"vo",sprite:"You got it!",delay:0,config:{}},{key:"vo",sprite:"Nice job!",delay:0,config:{}}],dropTarget:{x:0,y:212,texture:"general",frame:"dropTarget.png",correctFrame:"dropTargetCorrect.png",incorrectFrame:"dropTargetIncorrect.png",hitRadius:55,highlightFrame:"dropTargetHi.png"},dropTargetInterval:120,fragmentImages:[{x:0,y:0,texture:"general",frame:"circle1.png",body:{type:"circle",radius:35},highlightFrame:"circle1Hi.png"},{x:0,y:0,texture:"general",frame:"circle2.png",body:{type:"circle",radius:35},highlightFrame:"circle2Hi.png"},{x:0,y:0,texture:"general",frame:"circle3.png",body:{type:"circle",radius:35},highlightFrame:"circle3Hi.png"},{x:0,y:0,texture:"general",frame:"circle4.png",body:{type:"circle",radius:35},highlightFrame:"circle4Hi.png"}],fragmentBodyOptions:{friction:.05,restitution:.01,mass:1},fragmentText:{text:"",x:0,y:0,origin:{x:.5,y:.5},style:{fontFamily:"Russo One, Arial, Helvetica, sans",fontSize:17,color:"#ffffff",align:"center"}},jewels:[{x:0,y:0,texture:"jewel1",frame:"jewel10001.png",body:{type:"fromVerts",verts:"13 21 21 13 55 13 63 21 63 55 55 63 21 63 13 55"},sparkleAnimation:{key:"sparkle1",frameRate:15}},{x:0,y:0,texture:"jewel2",frame:"jewel20001.png",body:{type:"fromVerts",verts:"10 37 29 11 47 37 29 64"},sparkleAnimation:{key:"sparkle2",frameRate:15}},{x:0,y:0,texture:"jewel3",frame:"jewel30001.png",body:{type:"rectangle",width:52,height:52},sparkleAnimation:{key:"sparkle3",frameRate:15}},{x:0,y:0,texture:"jewel4",frame:"jewel40001.png",body:{type:"fromVerts",verts:"11 38 19 20 37 11 56 19 64 38 56 56 38 64 20 56"},sparkleAnimation:{key:"sparkle4",frameRate:15}}],jewelBodyOptions:{friction:.05,restitution:.01,mass:1},randomStartPositionBounds:{x:350,y:371,width:100,height:100},attractor:{x:400,y:421,radius:1,multiplier:15e-7},completionText:[{min:0,max:1,text:"Nice job.\nGo back to the menu to try another puzzle, or try to earn more jewels from this puzzle.",audio:{key:"vo",sprite:"Congratulations 1",delay:0,config:{}}},{min:2,max:3,text:"Great job!\nGo back to the menu to try another puzzle.",audio:{key:"vo",sprite:"Congratulations 2",delay:0,config:{}}},{min:4,max:4,text:"Outstanding! You earned all four jewels!\nGo back to the menu to try another puzzle.",audio:{key:"vo",sprite:"Congratulations 3",delay:0,config:{}}}],completionJewelSlots:[{x:220,y:240,texture:"general",frame:"jewel1SlotLg.png"},{x:340,y:240,texture:"general",frame:"jewel2SlotLg.png"},{x:460,y:240,texture:"general",frame:"jewel3SlotLg.png"},{x:580,y:240,texture:"general",frame:"jewel4SlotLg.png"}],puzzleStartSfx:{key:"sfx",sprite:"fragmentpop"},dropOnTargetSfx:{key:"sfx",sprite:"drop"},correctAnswerSfx:{key:"sfx",sprite:"correct"},hintSfx:{key:"sfx",sprite:"hint"},jewelDisappearSfx:{key:"sfx",sprite:"jeweldisappear"},jewelToSlotSfx:{key:"sfx",sprite:"jeweltoslot",config:{volume:.25}},instructionsVo:{key:"vo",sprite:"Instructions",delay:0,config:{}}}};